#!/usr/bin/env bash

set -e -o pipefail -u

self_dir=$(cd "$(dirname "$0")" &>/dev/null; pwd -P)
source "$self_dir"/utils.sh

intellij_version=${1-} # can be skipped; the same IntelliJ version that the plugin has been built against will be assumed

./gradlew \
  -PenableUiTests \
  -PtestResultsSubdir="$intellij_version" \
  -PintellijVersion="$intellij_version" \
  --info \
  --max-workers=1 \
  -Dorg.gradle.jvmargs=-Xmx256M \
  uiTests:test || {
    die 'UI tests failed; inspect Gradle and IDE logs above'
}